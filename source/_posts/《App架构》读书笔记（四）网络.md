---
title: 《App架构》读书笔记（四）网络
date: 2018-12-04 10:29:50
tags: iOS开发
---

# 网络

现在讨论的是关于网络层的处理，假设使用MVC架构，书中对比了两种方式：

1. Controller拥有网络。Controller直接控制发起网络请求，创建model，是比较常见的方式。如果要添加数据缓存到本地，通常这些逻辑也会写在controller里，使controller变得臃肿。它最大的优点是逻辑简单，目前大部分开发者都是这样写的。
2. Model拥有网络。Model从网络获取数据后，controller通过观察model变更通知来更新。这会在处理起来稍微麻烦一些，但是它能让代码分层，并且更符合单向数据流。而且如果要添加缓存功能的话，也能很轻松的添加在model层，由于controller本来就是观察model变更来更新的，model可以在一开始的时候就读取缓存，然后再请求网络。不仅逻辑结合的更加紧密，controller也变得简洁了。这里的model会和普通的model稍微不一样一点，其实是一个类似于数据管理者的概念，比如现在需要请求一个列表，产生一个数组，那这个数组其实会成为model的一个属性，而不是models。

**注意：这里说的“观察model变更”，不是说一定要用`KVO`或者`Notification`，普通的`block`或者`delegate`也算，它泛指一切能产生消息反馈的技术，当然`RAC`和`RxSwift`是最优雅的技术了**

书中举了一些例子，我就不一一列举了，大家如果感到模糊，最好自己查阅原书。

## 总结

目前我其实也是用的第1种方式，主要是因为习惯和简单，现在有很多的网络框架，以及Apple的Codable协议或者很多第三方转model框架，让网络请求和组织model的代码变得很少。但我也必须承认，还是第2种方式更好，通过观察model来进行UI更新，能最大程度的保证状态同步，并且统一了代码的更新路径，无论model作何更新，view都会自动同步；除此之外，代码的分层也更加完善了，controller更加简洁了。在页面之间传递数据的时候，同一个model（这个model是类而不是结构体或者枚举）在后面的页面被更新时，前面的页面也能自动更新，这也是一个不言而喻的优点。

如果是MVVM架构的话，组织网络请求本来就会被放在view-model里，所以MVVM其实本来就是第2种架构模式。不论用不用MVVM，响应式编程都是非常棒的体验，也是未来的趋势，在熟练使用之后，会有相逢恨晚的感觉。